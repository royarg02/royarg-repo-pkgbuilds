# Maintainer: Anurag Roy <anuragr9847@gmail.com>
pkgname="xivr"
pkgver=1.0.2
pkgrel=1
pkgdesc='Wrapper for *sxiv with nice features'
arch=('x86_64')
url="https://github.com/royarg02/${pkgname}"
license=('GPL-3.0-or-later')
depends=('nsxiv' 'util-linux')
makedepends=('git' 'dart')
optdepends=('sxiv: alternative image viewer')
source=("git+${url}#tag=${pkgver}"
        "xivr.desktop")
sha256sums=('ba3e314159714e2b5bb30ba5ee41de4b331b453a536a319894d9ce505c295a81'
            '3b05b3fbbda213d1c67d790b9b098ec962ca265b412f7e1b1024a1f16a3b583a')
options=(!strip)

prepare() {
  export PUB_CACHE="${srcdir}/pub-cache"
  dart pub get --directory="${pkgname}" --no-offline --no-precompile --suppress-analytics
}

build() {
  cd ${pkgname}
  [ ! -d build ] && mkdir build
  dart compile exe bin/xivr.dart -o build/xivr --suppress-analytics
}

package() {
  install -Dm755 -t "${pkgdir}/usr/bin" "${pkgname}/build/xivr"
  install -Dm644 -t "${pkgdir}/usr/share/applications" "${srcdir}/xivr.desktop"
  install -Dm644 -t "${pkgdir}/usr/share/licenses/${pkgname}" "${pkgname}/LICENSE"
}

